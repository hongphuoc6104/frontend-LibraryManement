<template>
  <form @submit.prevent="handleRegister" class="max-w-md mx-auto space-y-8 px-6 py-4">
    <h2 class="text-3xl font-extrabold text-center text-gray-900 mb-2">
      Táº¡o tÃ i khoáº£n má»›i
    </h2>
    <p class="text-center text-gray-600 mb-8">
      Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin Ä‘á»ƒ Ä‘Äƒng kÃ½ thÃ nh viÃªn ThÆ° Viá»‡n Trá»±c Tuyáº¿n.
    </p>

    <div class="space-y-6">
      <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2 border-gray-200">
        ThÃ´ng tin tÃ i khoáº£n
      </h3>
      <div>
        <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">Email <span class="text-red-500">*</span></label>
        <div class="relative">
          <input v-model="email" type="email" id="email" required placeholder="VÃ­ dá»¥: ban@example.com"
            class="peer w-full border border-gray-300 rounded-xl px-5 py-3 text-gray-800 placeholder-gray-400 
                   focus:outline-none focus:ring-3 focus:ring-indigo-300 focus:border-transparent 
                   transition-all duration-300 ease-in-out shadow-sm" />
          <svg class="absolute right-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 peer-focus:text-indigo-600 transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"></path>
          </svg>
        </div>
        <p v-if="errorEmail" class="text-red-600 text-sm mt-1">{{ errorEmail }}</p>
      </div>

      <div>
        <label for="password" class="block text-sm font-semibold text-gray-700 mb-2">Máº­t kháº©u <span class="text-red-500">*</span></label>
        <div class="relative">
          <input v-model="password" type="password" id="password" required placeholder="Tá»‘i thiá»ƒu 6 kÃ½ tá»±"
            class="peer w-full border border-gray-300 rounded-xl px-5 py-3 text-gray-800 placeholder-gray-400 
                   focus:outline-none focus:ring-3 focus:ring-indigo-300 focus:border-transparent 
                   transition-all duration-300 ease-in-out shadow-sm" />
          <svg class="absolute right-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 peer-focus:text-indigo-600 transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2v5a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2h6zM21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <p v-if="errorPassword" class="text-red-600 text-sm mt-1">{{ errorPassword }}</p>
      </div>

      <div>
        <label for="confirm" class="block text-sm font-semibold text-gray-700 mb-2">XÃ¡c nháº­n máº­t kháº©u <span class="text-red-500">*</span></label>
        <div class="relative">
          <input v-model="confirm" type="password" id="confirm" required placeholder="Nháº­p láº¡i máº­t kháº©u"
            class="peer w-full border border-gray-300 rounded-xl px-5 py-3 text-gray-800 placeholder-gray-400 
                   focus:outline-none focus:ring-3 focus:ring-indigo-300 focus:border-transparent 
                   transition-all duration-300 ease-in-out shadow-sm" />
          <svg class="absolute right-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 peer-focus:text-indigo-600 transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2v5a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2h6zM21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <p v-if="errorConfirm" class="text-red-600 text-sm mt-1">{{ errorConfirm }}</p>
      </div>
    </div>

    <div class="space-y-6 pt-6"> <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2 border-gray-200">
        ThÃ´ng tin cÃ¡ nhÃ¢n
      </h3>
      <div>
        <label for="hoLot" class="block text-sm font-semibold text-gray-700 mb-2">Há» lÃ³t <span class="text-red-500">*</span></label>
        <input v-model="hoLot" type="text" id="hoLot" required placeholder="VÃ­ dá»¥: Nguyá»…n VÄƒn"
          class="peer w-full border border-gray-300 rounded-xl px-5 py-3 text-gray-800 placeholder-gray-400 
                 focus:outline-none focus:ring-3 focus:ring-indigo-300 focus:border-transparent 
                 transition-all duration-300 ease-in-out shadow-sm" />
        <p v-if="errorHoLot" class="text-red-600 text-sm mt-1">{{ errorHoLot }}</p>
      </div>

      <div>
        <label for="ten" class="block text-sm font-semibold text-gray-700 mb-2">TÃªn <span class="text-red-500">*</span></label>
        <input v-model="ten" type="text" id="ten" required placeholder="VÃ­ dá»¥: A"
          class="peer w-full border border-gray-300 rounded-xl px-5 py-3 text-gray-800 placeholder-gray-400 
                 focus:outline-none focus:ring-3 focus:ring-indigo-300 focus:border-transparent 
                 transition-all duration-300 ease-in-out shadow-sm" />
        <p v-if="errorTen" class="text-red-600 text-sm mt-1">{{ errorTen }}</p>
      </div>

      <div>
        <label for="ngaySinh" class="block text-sm font-semibold text-gray-700 mb-2">NgÃ y sinh</label>
        <div class="relative">
            <input v-model="ngaySinh" type="date" id="ngaySinh"
                class="peer w-full border border-gray-300 rounded-xl px-5 py-3 text-gray-800 placeholder-gray-400 
                       focus:outline-none focus:ring-3 focus:ring-indigo-300 focus:border-transparent 
                       transition-all duration-300 ease-in-out shadow-sm pr-12" /> <svg class="absolute right-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 peer-focus:text-indigo-600 transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h.01M12 11h.01M15 11h.01M7 15h.01M11 15h.01M15 15h.01M17 19H7a2 2 0 01-2-2V5a2 2 0 012-2h10a2 2 0 012 2v12a2 2 0 01-2 2z"></path>
            </svg>
        </div>
      </div>

      <div>
        <label for="phai" class="block text-sm font-semibold text-gray-700 mb-2">Giá»›i tÃ­nh</label>
        <select v-model="phai" id="phai"
          class="peer w-full border border-gray-300 rounded-xl px-5 py-3 text-gray-800 
                 focus:outline-none focus:ring-3 focus:ring-indigo-300 focus:border-transparent 
                 transition-all duration-300 ease-in-out shadow-sm bg-white cursor-pointer">
          <option value="" disabled selected>--Chá»n giá»›i tÃ­nh--</option>
          <option value="Nam">Nam</option>
          <option value="Ná»¯">Ná»¯</option>
          <option value="KhÃ¡c">KhÃ¡c</option>
        </select>
      </div>

      <div>
        <label for="diaChi" class="block text-sm font-semibold text-gray-700 mb-2">Äá»‹a chá»‰</label>
        <input v-model="diaChi" type="text" id="diaChi" placeholder="VÃ­ dá»¥: 123 ÄÆ°á»ng ABC, Quáº­n XYZ"
          class="peer w-full border border-gray-300 rounded-xl px-5 py-3 text-gray-800 placeholder-gray-400 
                 focus:outline-none focus:ring-3 focus:ring-indigo-300 focus:border-transparent 
                 transition-all duration-300 ease-in-out shadow-sm" />
      </div>
      
      <div>
        <label for="dienThoai" class="block text-sm font-semibold text-gray-700 mb-2">Sá»‘ Ä‘iá»‡n thoáº¡i</label>
        <input v-model="dienThoai" type="tel" id="dienThoai" placeholder="VÃ­ dá»¥: 0901234567"
          class="peer w-full border border-gray-300 rounded-xl px-5 py-3 text-gray-800 placeholder-gray-400 
                 focus:outline-none focus:ring-3 focus:ring-indigo-300 focus:border-transparent 
                 transition-all duration-300 ease-in-out shadow-sm" />
      </div>
    </div>

    <button type="submit"
      class="w-full bg-gray-800 text-white font-bold py-3 rounded-xl shadow-lg mt-8 
             hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-indigo-500/50 focus:ring-offset-2 
             transition-all duration-300 transform hover:-translate-y-1 active:scale-95"
    >
      ÄÄƒng kÃ½ tÃ i khoáº£n
    </button>

    <p v-if="message" :class="message.includes('thÃ nh cÃ´ng') ? 'text-green-600' : 'text-red-600'" 
       class="text-center font-medium mt-4 flex items-center justify-center">
        <svg v-if="message.includes('thÃ nh cÃ´ng')" class="h-5 w-5 mr-1 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <svg v-else class="h-5 w-5 mr-1 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        {{ message }}
    </p>

    <p class="text-center text-sm text-gray-600 mt-6">
      ÄÃ£ cÃ³ tÃ i khoáº£n?
      <router-link to="/auth/login" class="text-indigo-600 font-semibold hover:underline hover:text-indigo-800 transition-colors duration-200">
        ÄÄƒng nháº­p ngay
      </router-link>
    </p>
  </form>
</template>

<script setup>
import { ref } from 'vue'
import { useRouter } from 'vue-router'
import axios from 'axios'

// ğŸ§ Info cÃ¡ nhÃ¢n
const hoLot Â  Â  = ref('')
const ten Â  Â  Â  = ref('')
const ngaySinh Â = ref('')
const phai Â  Â  Â = ref('')
const diaChi Â  Â = ref('')
const dienThoai = ref('')

// ğŸ” TÃ i khoáº£n
const email Â  Â = ref('')
const password = ref('')
const confirm Â = ref('')
const message Â = ref('')

const errorHoLot Â  Â = ref('')
const errorTen Â  Â  Â = ref('')
const errorEmail Â  Â = ref('')
const errorPassword = ref('')
const errorConfirm Â = ref('')

const router = useRouter()

const handleRegister = async () => {
Â  // Reset lá»—i
Â  errorHoLot.value = ''
Â  errorTen.value = ''
Â  errorEmail.value = ''
Â  errorPassword.value = ''
Â  errorConfirm.value = ''
Â  message.value = ''

Â  let hasError = false

Â  if (!hoLot.value) {
Â  Â  errorHoLot.value = 'Vui lÃ²ng nháº­p há» lÃ³t.'
Â  Â  hasError = true
Â  }

Â  if (!ten.value) {
Â  Â  errorTen.value = 'Vui lÃ²ng nháº­p tÃªn.'
Â  Â  hasError = true
Â  }

Â  if (!email.value) {
Â  Â  errorEmail.value = 'Vui lÃ²ng nháº­p email.'
Â  Â  hasError = true
Â  } else {
Â  Â  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
Â  Â  if (!emailRegex.test(email.value)) {
Â  Â  Â  errorEmail.value = 'Email khÃ´ng há»£p lá»‡.'
Â  Â  Â  hasError = true
Â  Â  }
Â  }

Â  if (!password.value) {
Â  Â  errorPassword.value = 'Vui lÃ²ng nháº­p máº­t kháº©u.'
Â  Â  hasError = true
Â  } else if (password.value.length < 6) {
Â  Â  errorPassword.value = 'Máº­t kháº©u pháº£i tá»« 6 kÃ½ tá»±.'
Â  Â  hasError = true
Â  }

Â  if (!confirm.value) {
Â  Â  errorConfirm.value = 'Vui lÃ²ng xÃ¡c nháº­n máº­t kháº©u.'
Â  Â  hasError = true
Â  } else if (password.value !== confirm.value) {
Â  Â  errorConfirm.value = 'Máº­t kháº©u khÃ´ng khá»›p.'
Â  Â  hasError = true
Â  }

Â  if (hasError) {
    message.value = 'Vui lÃ²ng kiá»ƒm tra láº¡i cÃ¡c trÆ°á»ng bá»‹ lá»—i.'
    return
  }

Â  try {
Â  Â  const userRes = await axios.post('http://localhost:5000/api/users', {
Â  Â  Â  hoLot: hoLot.value,
Â  Â  Â  ten: ten.value,
Â  Â  Â  ngaySinh: ngaySinh.value,
Â  Â  Â  phai: phai.value,
Â  Â  Â  diaChi: diaChi.value,
Â  Â  Â  dienThoai: dienThoai.value
Â  Â  })

Â  Â  const refId = userRes.data._id

Â  Â  await axios.post('http://localhost:5000/api/account/register', {
Â  Â  Â  email: email.value,
Â  Â  Â  password: password.value,
Â  Â  Â  role: 'user',
Â  Â  Â  refId,
Â  Â  Â  refModel: 'User'
Â  Â  })

Â  Â  message.value = 'Táº¡o tÃ i khoáº£n thÃ nh cÃ´ng ğŸ‰'
Â  Â  setTimeout(() => {
Â  Â  Â  router.push('/auth/login')
Â  Â  }, 2000) // Chuyá»ƒn hÆ°á»›ng sau 2 giÃ¢y Ä‘á»ƒ ngÆ°á»i dÃ¹ng Ä‘á»c thÃ´ng bÃ¡o
Â  } catch (err) {
Â  Â  message.value = err.response?.data?.message || 'ÄÃ£ cÃ³ lá»—i xáº£y ra khi Ä‘Äƒng kÃ½ tÃ i khoáº£n. Vui lÃ²ng thá»­ láº¡i.'
Â  }
}
</script>